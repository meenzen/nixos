#!/usr/bin/env bash

set -eo pipefail

source "$(dirname "$0")/lib.sh"

print "=> Starting Storage Optimization"

print "==> Running \"nix-collect-garbage\""
nix-collect-garbage --delete-older-than 7d

print "==> Running \"nix-collect-garbage\" as root"
sudo nix-collect-garbage --delete-older-than 7d

print "==> Running \"sudo nix-store --optimise\""
sudo nix-store --optimise

print "=> Done!"
