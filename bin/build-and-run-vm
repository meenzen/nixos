#!/usr/bin/env bash

set -eo pipefail

source "$(dirname "$0")/lib.sh"

print_start "Building and Running VM"

print_status "Formatting Code"
alejandra . >/dev/null 2>&1

print_status "Building VM"
git add .
nixos-rebuild build-vm --upgrade --verbose --flake .#vm

print_status "Starting VM"
./result/bin/run-vm-vm

prompt_or_exit "Do you want to delete the disk image?"

print_status "Deleting Disk Image"
rm -f vm.qcow2
